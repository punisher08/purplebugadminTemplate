<div class="result">
<div class="cal-header">
<div class="ndl-GridItem ndl-GridItem--alignLeft plan-VisualCalendarHeader-leftActions" data-size="5">
    <div class="ndl-SearchBar-collapsed">
        <div class="ndl-FormControl ndl-FormControl--medium plan-VisualCalendarHeader-searchBar">
            <div class="ndl-FormControl-labelWrapper"></div>
            <span class="ndl-Input ndl-Input--medium ndl-Input--hasLeftIcon ndl-FormControl-field">
                <span class="ndl-Input-field-wrapper">
                    <span class="ndl-Input-field">
                        <span class="nc-icon ndl-Icon ndl-Input-icon nc-click-hover">
                            <i class="nc-icon-wrapper">
                                <svg viewBox="0 0 16 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <desc>Created with Sketch.</desc>
                                    <defs></defs>
                                    <g id="UI" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                        <g id="16" transform="translate(-217.000000, -399.000000)" fill="#444444">
                                            <path
                                                d="M229.7,410.3 C230.6,409.1 231.1,407.7 231.1,406.1 C231.1,402.2 228,399 224.1,399 C220.2,399 217,402.2 217,406.1 C217,410 220.2,413.2 224.1,413.2 C225.7,413.2 227.2,412.7 228.3,411.8 L231.3,414.8 C231.5,415 231.8,415.1 232,415.1 C232.2,415.1 232.5,415 232.7,414.8 C233.1,414.4 233.1,413.8 232.7,413.4 L229.7,410.3 L229.7,410.3 Z M224.1,411.1 C221.3,411.1 219,408.9 219,406.1 C219,403.3 221.3,401 224.1,401 C226.9,401 229.2,403.3 229.2,406.1 C229.2,408.9 226.9,411.1 224.1,411.1 L224.1,411.1 Z"
                                                id="Fill-191"
                                            ></path>
                                        </g>
                                    </g>
                                </svg>
                            </i>
                        </span>
                        <input class="ndl-Input-input" type="text" placeholder="Search..." value="" />
                    </span>
                </span>
            </span>
        </div>
    </div>
    <button class="ndl-Button ndl-Button--default ndl-Button--medium plan-VisualCalendarHeader-todayButton" type="button"><span class="ndl-Button-label">Today</span></button>
    <button class="min-date ndl-Button ndl-Button--secondaryAlt ndl-Button--medium ndl-Button--iconOnly" type="button">
        <span class="nc-icon ndl-Icon ndl-Button-icon">
            <i class="nc-icon-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16">
                    <g transform="translate(0, 0)"><polygon fill="#444444" points="11.1,15.7 3.4,8 11.1,0.3 12.6,1.7 6.3,8 12.6,14.3 "></polygon></g>
                </svg>
            </i>
        </span>
    </button>
    <button class="add-date ndl-Button ndl-Button--secondaryAlt ndl-Button--medium ndl-Button--iconOnly" type="button">
        <span class="nc-icon ndl-Icon ndl-Button-icon">
            <i class="nc-icon-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16">
                    <g transform="translate(0, 0)"><polygon fill="#444444" points="4.9,15.7 3.4,14.3 9.7,8 3.4,1.7 4.9,0.3 12.6,8 "></polygon></g>
                </svg>
            </i>
        </span>
    </button>
    <input type="text" id="config-demo" class="form-control">
</div>

<!--Hello World-->
<div class="ndl-GridItem ndl-GridItem--alignRight" data-size="7">
    <div class="plan-TabActions">
        <!--button class="ndl-Button ndl-Button--primary ndl-Button--medium plan-ShareView" type="button">
            <span class="nc-icon ndl-Icon ndl-Button-icon">
                <i class="nc-icon-wrapper">
                    <svg viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M10 5.13605V8.00005H2V5.13605L0 3.80005V9.00005C0 9.26526 0.105357 9.51962 0.292893 9.70716C0.48043 9.89469 0.734784 10 1 10H11C11.2652 10 11.5196 9.89469 11.7071 9.70716C11.8946 9.51962 12 9.26526 12 9.00005V3.80005L10 5.13605Z"
                            fill="#177DD6"
                        ></path>
                        <path d="M12 2L6 6L0 2V1C0 0.734784 0.105357 0.48043 0.292893 0.292893C0.48043 0.105357 0.734784 0 1 0H11C11.2652 0 11.5196 0.105357 11.7071 0.292893C11.8946 0.48043 12 0.734784 12 1V2Z" fill="#177DD6"></path>
                    </svg>
                </i>
            </span>
            <span class="ndl-Button-label">Share</span>
        </button-->
        <!--span class="plan-TabActions-action">
            <button class="ndl-Button ndl-Button--default ndl-Button--medium plan-PlanSavedView-saveView" type="button"><span class="ndl-Button-label">Save View</span></button>
        </span-->
        <!--div class="ndl-Dropdown">
            <button class="ndl-Button ndl-Button--secondaryAlt ndl-Button--medium ndl-Dropdown-button ndl-Button--iconOnly" type="button">
                <span class="nc-icon ndl-Icon ndl-Button-icon">
                    <i class="nc-icon-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 16 16">
                            <g transform="translate(0, 0)">
                                <circle data-color="color-2" fill="#444444" cx="8" cy="8" r="2"></circle>
                                <circle fill="#444444" cx="2" cy="8" r="2"></circle>
                                <circle fill="#444444" cx="14" cy="8" r="2"></circle>
                            </g>
                        </svg>
                    </i>
                </span>
            </button>
        </div-->
    </div>
</div>
</div>



<div id='calendar' readonly style="opacity:0"></div>

<style>
.cal-header .ndl-GridItem--alignLeft {
    float: left;
}
.cal-header .ndl-GridItem--alignRight {
    float: right;
    margin-right:20px;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions {
    display: flex;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions button {
    background: #fff;
    border: solid 1px #c7c7c7;
    border-radius: 4px;
    cursor: pointer;
}
.fc-header-toolbar.fc-toolbar {
    position: absolute;
    top: -5px;
    left: 225px;
    padding: 6px;
    background: #fff;
}
input.custom-combobox-input {
    width: 100%;
    height: 40px;
    padding: 10px;
    background: transparent;
    border-radius: 3px;
    padding-right: 30px;
}
.result {
    position: relative;
}

.fc .fc-toolbar.fc-header-toolbar .fc-toolbar-chunk:first-child {
    display: none;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions .plan-PlanSavedView-saveView {
    height: 38px;
    color: #4655d7;
    font-weight: 600;
    width: 86px;
    margin-right: 15px;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions .ndl-Dropdown-button {
    height: 37px;
    width: 28px;
    border: none;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions .plan-ShareView {
    display: flex;
    width: 80px;
    margin-right: 15px;
    padding: 7px;
    background: #313cb1;
    color: #fff;
    text-align: center;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions .plan-ShareView svg {
    width: 15px;
    margin-top: 3px;
    margin-right: 8px;
}
.cal-header .ndl-GridItem--alignRight .plan-TabActions .plan-ShareView svg path {
    fill: white;
}
.cal-header {
    overflow: hidden;
}
.plan-VisualCalendarHeader-leftActions {
    display: flex;
    margin-left: 19px;
}

.plan-VisualCalendarHeader-leftActions .ndl-SearchBar-collapsed {position:relative;padding-right: 20px;/* max-width: 60px; */}
 
.plan-VisualCalendarHeader-leftActions .ndl-SearchBar-collapsed .ndl-Input-icon.nc-click-hover svg {
    width: 15px;
    position: absolute;
    left: 10px;
    top: 10px;
}
.plan-VisualCalendarHeader-leftActions input.ndl-Input-input {
    padding-left: 30px;
    height: 35px;
    border-color: #c1c1c1;
}

.plan-VisualCalendarHeader-leftActions .ndl-Button {
    background: none;
    border: solid 1px #b9b9b9;
    border-radius: 4px;
    max-width: 60px;
    cursor: pointer;
}

.plan-VisualCalendarHeader-leftActions  .plan-VisualCalendarHeader-todayButton {
    padding: 4px 13px;
    color: #4655d7;
    font-weight: 600;
    margin-right: 15px;
}

.plan-VisualCalendarHeader-leftActions .ndl-Button--secondaryAlt {
    width: 25px;
    border: none;
}
td.fc-daygrid-day {
    max-height: 100px;
    position: relative;
}
.fc .fc-daygrid-event-harness-abs,
.fc .fc-daygrid-body-balanced .fc-daygrid-day-events {
    position: inherit !important;
    visibility:visible !important;
}
.fc-daygrid-day-events .fc-event-main img.feature-image {
    max-height: 92px;
}
#calendar {
    max-width: 1100px;
    margin: 20px auto;
    margin-top: 20px;
    margin-right: auto;
    margin-bottom: 20px;
    margin-left: auto;
}
.fc .fc-daygrid-event-harness {
    margin-bottom: 20px !important;
}
.fc-header-toolbar.fc-toolbar.fc-toolbar-ltr {
    display: none;
}
.fc-event-resizable span.title {
    clear: both;
    font-weight: bold;
    padding: 0 7px;
    margin-top: 5px;
    color: #636060;
    text-transform: capitalize;
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.fc-event-title.fc-sticky {
    color: #000;
    font-weight: bold;
    text-align: center;
    display: block;
    border: solid 1px #c1c1c1;
    border-radius: 4px;
}
.fc-daygrid-event-harness, a.fc-daygrid-event {
    padding: 0 !important;
    margin: 0 !important;
}
a.fc-daygrid-event {
    background: transparent;
    border: transparent;
    padding: 4px;
}
.medias {
    float: left;
    width: 100%;
    padding: 0 7px;
    color: #74748b;
}
button.add-new {
    width: 100%;
    height: 48px;
    background: none;
    border: 1px dashed #ccccdc !important;
    padding: 10px;
    cursor: pointer;
}
.fc .fc-daygrid-day-frame {
    min-height: auto !important;
}
.new-container{
    width: 100%;
}
.medias span.media {
    display: block;
    font-weight: bold;
}
.medias span.media .time {
    /* display: flex; */
    margin-right: 8px;
    font-style: normal;
    font-weight: 500;
}
 
.new-container ul.ndl-Dropdown-menuItems {
    margin: -13px auto;
    text-align: center;
    max-height: 250px;
    background: #fff !important;
    overflow: auto;
    width: 74px;
    border: solid 1px #c1c1c1;
    border-radius: 4px;
    position: absolute;
    right: 40px;
    z-index: 99;
}

.new-container ul.ndl-Dropdown-menuItems li {
    margin: 0;
    color: #191932;
    padding: 8px 12px;
    cursor: pointer;
}

.new-container ul.ndl-Dropdown-menuItems li:hover {
    background-color: #f5f7fa;
}
 
.form-group{
    margin-bottom:15px;
}
 .form-group textarea,
 .form-group select, .form-group .input-field {
    width: 100%;
    max-width: 100%;
    min-height: 35px !important;
    padding: 5px 10px;
}

div#create-task .create-task-button {
    text-align: center;
    margin-top: 20px;
}
.create-task-button {
    text-align: center;
}
.create-task-button .submit-task {
    background: #4655d7;
    border: none;
    color: #fff;
    display: inline-block;
    cursor: pointer;
    vertical-align: top;
    padding: 10px 0;
    border-radius: 4px;
    width: 65px;
    line-height: 1;
    font-weight: 600;
    font-size: 14px;
    margin-left: 10px;
}

.create-task-button .close {
    text-decoration: none;
    vertical-align: middle;
    line-height: 2.5;
    font-size: 14px;
    font-weight: bold;
}
.datepicker {
    position: absolute;
}
.tsk-WorkflowForm-step {
    align-items: center;
    border: 1px solid #ccccdc;
    margin: 15px 0;
    display: flex;
    padding: 0 12px;
    border-radius: 4px;
    position: relative;
}
.tsk-WorkflowForm-container .tsk-WorkflowForm-selector {
    margin-right: 16px;
}
span.custom-combobox {
    position: relative;
}

span.custom-combobox a.ui-button {
    position: absolute;
    top: -12px;
    right: 0;
    height: 39px;
    width: 37px;
    background: transparent;
    border: none;
}
.ndl-AvatarPicker {
    align-items: center;
    width: 100px;
    text-align: center;
}
.assign-role {
    position: absolute;
    left: -243px;
    background: #fff;
    padding: 10px;
    width: 240px;
    border: 1px solid #ccccdc;
    border-radius: 4px;
}
.tsk-WorkflowForm-step .tsk-WorkflowForm-substep {
    align-items: center;
    display: flex;
}
.tsk-WorkflowForm-dueDate {
    width: 165px;
}

.tsk-WorkflowForm-dueDate button.ndl-Button {
    background: transparent;
    border: none;
    color: #4655d7;
    font-weight: bold;
    padding: 0;
    font-size: 12px;
}
.ndl-AvatarPicker span.nc-icon svg {
    width: 10px;
    /* fill: #4655d7 !important; */
    /* color: #4655d7; */
}
.ndl-AvatarPicker span.nc-icon {
    width: 10px;
    border: dashed 1px #4655d7;
    line-height: 0;
    padding: 9px;
    border-radius: 50%;
    height: 9px;
    display: inline-block;
}

.ndl-AvatarPicker span.nc-icon svg g path {
    fill: #4655d7 !important;
    color: #4655d7;
}

.ndl-HeaderTitle--medium {
    font-size: 16px;
    font-weight: 600;
    line-height: 20px;
    /* margin-bottom: 0; */
}
.tsk-WorkflowForm-assignee {
    width: 90%;
}
.workflow_roles {
    display: none;
}
.hasDatepicker .ui-datepicker {
    position: absolute;
}
input#config-demo {
    border: none;
    background: none;
    color: #191932;
    cursor: pointer;
    display: inline-flex;
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
    width: 215px;
    text-align:center;
}
</style>
<?php 
  $args = array(
        'numberposts'      => -1,
        'orderby'          => 'date',
        'order'            => 'DESC',
        'post_type'        => 'event-task',
        'post_status'    => 'publish'
    );

  $posts = get_posts($args); 
  if(!empty($posts)){
    $push = array();
    foreach($posts as $post){
      $post_id = $post->ID;
      $task_start_date=  get_post_meta($post_id,'task_start_date',true);
      $task_end_date = get_post_meta($post_id,'task_end_date',true);
      $attachment_id =get_post_meta($post_id,'attachment_id',true);
      //echo $attachment_id;
      //$feat_image_url = ;

      $imageids = get_post_meta($attachment_id,'upload_image',true);

      $imageurl = wp_get_attachment_url($imageids[0]);

      $push[]= array( 
          'title' => (get_the_title($attachment_id)!='')?get_the_title($attachment_id):$post->post_title,
          'start'=>$task_start_date,
          'end'=>$task_start_date,
          'imageUrl'=>$imageurl,
          'id' =>$post_id
          
          //'imageUrl'=> 

        );
      
    }

    
  }
 

   $url = get_site_url().'/wp-admin/admin.php?page=view-plan&id=';

   $workflowargs = array(
        'numberposts'      => -1,
        'orderby'          => 'date',
        'order'            => 'DESC',
        'post_status'      => 'publish',
        'post_type'        => 'workflow',
 
    );

    $workflows = get_posts( $workflowargs );

    if(!empty($workflows)){
        foreach($workflows as $workflow){
            $w_titlr[] = $workflow->post_title;
        }
    }
    $w_tojson = json_encode($w_titlr);
    


    
?>
<script class="calendar">
var date = new Date();
var date2 = new Date();
var minus30 = date.setDate(date.getDate() +30); // add 30 days

jQuery('.plan-VisualCalendarHeader-todayButton').click(function() {
    calendar_v(date2,minus30);
});
var index = 1;
jQuery('button.add-date').click(function (){
     var add = index*30;  
     var date = new Date();
     var date23 = new Date();
     var minus301 = date.setDate(date.getDate() +add); // add 30 days
         console.log(minus301);
         calendar_v(date23,new Date(minus301));
    index++;

}); 

calendar_v(date2,minus30);
jQuery('#config-demo').daterangepicker({
    "timePicker": true,
    locale: {
            format: 'MMM D, Y'
        },
    ranges: {
        'Today': [moment(), moment()],
        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
        'This Month': [moment().startOf('month'), moment().endOf('month')],
        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
    },
    "alwaysShowCalendars": true,
    "startDate": minus30,
    "endDate": date,
    "drops": "auto"
}, function(start, end, label) {
    console.log(start);
    calendar_v(start.format('YYYY-MM-DD'),end.format('YYYY-MM-DD'));
});

function calendar_v(start,end){

    var cal_url = '<?php echo $url;?>';

    var d = new Date();

    var month = d.getMonth()+1;
    var day = d.getDate();

    var output = d.getFullYear() + '-' +
        ((''+month).length<2 ? '0' : '') + month + '-' +
        ((''+day).length<2 ? '0' : '') + day;
  
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
  
      headerToolbar: {
       
      },
      //defaultView: 'basicWeek',
       // defaultView: 'dayGridMonth',
         validRange: {
          start: start,
          end: end
        },
      selectable: true,
      selectHelper: false,
      editable: true,
      eventClick: function(info) {
         window.location.assign(cal_url+info.event._def.publicId+'#content'); 
      },
      dateClick: function (arg){
      jQuery('.new-container').remove();
      jQuery( "#task-due-date" ).datepicker({dateFormat : 'dd-mm-yy',minDate: 0});
      jQuery( "#event-due-date" ).datepicker({dateFormat : 'dd-mm-yy',minDate: 0});
      jQuery( arg.dayEl ).append('<div class="new-container"><button class="add-new ndl-Button ndl-Button--inline ndl-Button--medium    ndl-Dropdown-button" type="button"><span class="ndl-Button-label">+ Add New</span></button><ul class="ndl-Dropdown-menuItems is-scrollable"><li class="create-task"><div class="ndl-Dropdown-option     ndl-Option  " role="menuitem"><span class="ndl-Option-label ">Task</span></div></li><li class="new-event"><div class="ndl-Dropdown-option     ndl-Option  " role="menuitem"><span class="ndl-Option-label ">Event</span></div></li></ul></div>');

      
//
        setTimeout(function (){
           jQuery('li.create-task').click(function(){
               
                jQuery('a.close-modal').click(function () {
                    jQuery('.workflow_roles').hide();
                    alert('Hello World');
                });
              
            jQuery('#task_start_date').val(arg.dateStr);
            jQuery('#task-due-date').val(arg.dateStr);
            
            jQuery("#creat-task-form").submit(function(e) {
                 var form = jQuery(this);
               e.preventDefault();
               
                 jQuery.ajax({
                        type: "POST",
                        url: ajaxurl, 
                       // contentType: 'application/x-www-form-urlencoded',
                        data : { action:'ppb_creation', task:form.serializeArray() }, // serializes the form's elements.
                        success: function(data) {

                          jQuery( arg.dayEl ).append('<div class="fc-daygrid-event-harness" style="margin-top: 0px;"><a class="fc-daygrid-event fc-daygrid-block-event fc-h-event fc-event fc-event-draggable fc-event-resizable fc-event-start fc-event-end fc-event-past"><div class="fc-event-main"><div class="fc-event-main-frame"><div class="fc-event-title-container"><div class="fc-event-title fc-sticky">'+data+'</div></div></div></div><div class="fc-event-resizer fc-event-resizer-end"></div></a></div>');
                             console.log(data);
                           
                            jQuery('.new-container').remove();
                            jQuery('a.close-modal').trigger('click');
                            
                             jQuery('form#creat-task-form').trigger("reset");
                            jQuery('.workflow_roles').hide();
                        }
                    });
              });
           
               jQuery("#create-task").modal({
                escapeClose: true,
                clickClose: true,
                showClose: true
              });

            jQuery( ".date" ).datepicker({dateFormat : 'dd-mm-yy',
        setDate: arg.dateStr });
           
              
              var availableTags = <?php echo $w_tojson; ?>



                 jQuery.widget( "custom.combobox", {
                              _create: function() {
                                this.wrapper = jQuery( "<span>" )
                                  .addClass( "custom-combobox" )
                                  .insertAfter( this.element );
                         
                                this.element.hide();
                                this._createAutocomplete();
                                this._createShowAllButton();
                              },
                         
                              _createAutocomplete: function() {
                                var selected = this.element.children( ":selected" ),
                                  value = selected.val() ? selected.text() : "";

                               
                                this.input = jQuery( "<input name='workflow'>" )
                                  .appendTo( this.wrapper )
                                  .val( value )
                                  .attr( "title", "" )
                                  .addClass( "custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left" )
                                  .autocomplete({
                                    delay: 0,
                                    minLength: 0,
                                    source: jQuery.proxy( this, "_source" )
                                  })
                                  .tooltip({
                                    classes: {
                                      "ui-tooltip": "ui-state-highlight"
                                    }
                                  });
                         
                                this._on( this.input, {
                                  autocompleteselect: function( event, ui ) {
                                    ui.item.option.selected = true;
                                    this._trigger( "select", event, {
                                      item: ui.item.option
                                    });
                                       
                                      
                                        //log( "Selected: " + ui.item.value + " aka " + ui.item.id );
                                         jQuery('#workflow_id').val(ui.item.option.outerHTML.split('"')[1]);
                                          jQuery.ajax({
                                            url : ajaxurl, // Here goes our WordPress AJAX endpoint.
                                            type : 'GET',
                                            
                                            data : {action:'get_workflow',workflow: ui.item.option.outerHTML.split('"')[1]
                                             
                                            },
                                            success : function( response ) {
                                              jQuery('.workflow_roles').html(response);
                                                  jQuery('.workflow_roles').show();
                                                jQuery('.ndl-AvatarPicker span.nc-icon').click(function(){

                                                   var data = jQuery(this).attr('data');
                                                    //alert('Hello World');
                                                    jQuery('.assign-'+data).show();
                                                    jQuery('.assign-role'+' .assign-'+data ).change(function() {

                                                     var selectedVal = jQuery(".assign-role .assign-"+data+" option").filter(":selected").val();
                                                     var selectedtext = jQuery(".assign-role .assign-"+data+" option").filter(":selected").text();
                                                     
                                                       
                                                       jQuery('.assign-role').hide();
                                                       jQuery('.role-'+data).text(selectedtext); 
                                                       jQuery('#Qarticle_role_'+data).val(selectedVal);

                                                        
                                                    });

                                                });

                                                jQuery('.tsk-WorkflowForm-dueDate button.ndl-Button').click(function(){
                                                          var data = jQuery(this).attr('data');
                                                          jQuery(this).hide();
                                                          jQuery('.datepicker-'+data).show();
                                                            jQuery('.datepicker-'+data).datepicker({
                                                               option: true,
                                                               dateFormat: 'M d, yy' ,
                                                                onSelect: function (dateText, inst) {
                                                                    
                                                                    var date = jQuery(this).val();
                                                                
                                                                    jQuery('#Qarticle_due_date_'+data).val(date);
                                                                    jQuery('.datepicker-'+data).hide();
                                                                    
                                                                    jQuery('.dueDate-'+data+' .ndl-Button--inline').show();
                                                                    jQuery('.dueDate-'+data+' .ndl-Button--inline span.ndl-Button-label').text('Due on '+date);
                                                                    
                                                                   // 
                                                                   // jQuery('.dueDate-'+data+' button.ndl-Button').show();
                                                                    //jQuery('.dueDate-'+data+' .hasDatepicker').hide();
                                                                    //jQuery('#Qarticle_due_date_'+data).val(date);
                                                                     
                                                                }
                                                            });
                                                        });

                                            } 
                                          }); 

                                    
                                    
                                  },
                         
                                  autocompletechange: "_removeIfInvalid"
                                });
                              },
                         
                              _createShowAllButton: function() {
                                var input = this.input,
                                  wasOpen = false;
                         
                               jQuery( "<a>" )
                                  .attr( "tabIndex", -1 )
                                  .attr( "title", "Show All Items" )
                                  .tooltip()
                                  .appendTo( this.wrapper )
                                  .button({
                                    icons: {
                                      primary: "ui-icon-triangle-1-s"
                                    },
                                    text: false
                                  })
                                  .removeClass( "ui-corner-all" )
                                  .addClass( "custom-combobox-toggle ui-corner-right" )
                                  .on( "mousedown", function() {
                                    wasOpen = input.autocomplete( "widget" ).is( ":visible" );
                                  })
                                  .on( "click", function() {
                                    input.trigger( "focus" );
                         
                                    // Close if already visible
                                    if ( wasOpen ) {
                                      return;
                                    }
                         
                                    // Pass empty string as value to search for, displaying all results
                                    input.autocomplete( "search", "" );
                                  });
                              },
                         
                              _source: function( request, response ) {
                                var matcher = new RegExp( jQuery.ui.autocomplete.escapeRegex(request.term), "i" );
                                response( this.element.children( "option" ).map(function() {
                                  var text = jQuery( this ).text();
                                  if ( this.value && ( !request.term || matcher.test(text) ) )
                                    return {
                                      label: text,
                                      value: text,
                                      option: this
                                    };
                                }) );
                              },
                             
                              _removeIfInvalid: function( event, ui ) {
                         
                                // Selected an item, nothing to do
                                if ( ui.item ) {
                                  return;
                                }
                         
                                // Search for a match (case-insensitive)
                                var value = this.input.val(),
                                  valueLowerCase = value.toLowerCase(),
                                  valid = false;
                                this.element.children( "option" ).each(function() {
                                  if ( jQuery( this ).text().toLowerCase() === valueLowerCase ) {
                                    this.selected = valid = true;
                                    return false;
                                  }
                                });
                         
                                // Found a match, nothing to do
                                if ( valid ) {
                                  return;
                                }
                         
                                // Remove invalid value
                                this.input
                                  .val( "" )
                                  .attr( "title", value + " didn't match any item" )
                                  .tooltip( "open" );
                                this.element.val( "" );
                                this._delay(function() {
                                  this.input.tooltip( "close" ).attr( "title", "" );
                                }, 2500 );
                                this.input.autocomplete( "instance" ).term = "";
                              },
                         
                              _destroy: function() {
                                this.wrapper.remove();
                                this.element.show();
                              }
                            });
                         
                            jQuery( "#combobox" ).combobox();
                         
 


          });
          jQuery('li.new-event').click(function(){
              console.log(arg.dateStr);
              jQuery('#task_start_date-event').val(arg.dateStr);
              jQuery('#event-due-date').val(arg.dateStr);
              
              jQuery("#create-event-form").submit(function(e) {
                 var form = jQuery(this);
               e.preventDefault();
               
                 jQuery.ajax({
                        type: "POST",
                        url: ajaxurl, 
                       // contentType: 'application/x-www-form-urlencoded',
                        data : { action:'ppb_creation', task:form.serializeArray() }, // serializes the form's elements.
                        success: function(data) {
                             jQuery( arg.dayEl ).append('<div class="fc-daygrid-event-harness" style="margin-top: 0px;"><a class="fc-daygrid-event fc-daygrid-block-event fc-h-event fc-event fc-event-draggable fc-event-resizable fc-event-start fc-event-end fc-event-past"><div class="fc-event-main"><div class="fc-event-main-frame"><div class="fc-event-title-container"><div class="fc-event-title fc-sticky">'+data+'</div></div></div></div><div class="fc-event-resizer fc-event-resizer-end"></div></a></div>');
                            jQuery('.new-container').remove();
                            jQuery('a.close-modal').trigger('click');
                        }
                    });
              });

               jQuery("#create-event").modal({
                escapeClose: true,
                clickClose: true,
                showClose: true
              });
              jQuery( ".date" ).datepicker({minDate: 0,dateFormat : 'dd-mm-yy',
                defaultDate: new Date(arg.dateStr) });

          });
        },500);



            
         
      },
    editable: true,
    eventDrop: function(event,dayDelta,minuteDelta,allDay,revertFunc) {

        alert(
            event.title + " was moved " +
            dayDelta + " days and " +
            minuteDelta + " minutes."
        );

        if (allDay) {
            alert("Event is now all-day");
        }else{
            alert("Event has a time-of-day");
        }

        if (!confirm("Are you sure about this change?")) {
            revertFunc();
        }

    },
      eventContent: function (arg, createElement) {
   
          var innerHtml;
             //Check if event has image
          if (arg.event._def.extendedProps.imageUrl) {

            var data = arg.event._def.extendedProps;
            
           // Store custom html code in variable
           innerHtml = "<img class='feature-image' style='width:100%;' src='"+data.imageUrl+"'><span class='title'>"+arg.event._def.title+'</span><div class="medias"><span class="media wordPress"><i class="time">05:00 PM</i><img src="'+plugin_url+'/purple/admin/partials/images/wordpress.png" width="12" height="12"></span><span class="media facebook"><i class="time">05:00 PM</i><img src="'+plugin_url+'/purple/admin/partials/images/facebook.png" width="12" height="12"></span><span class="media linkedin"><i class="time">05:00 PM</i><img src="'+plugin_url+'/purple/admin/partials/images/linkedin.png" width="12" height="12"></span></div>';

           //Event with rendering html
           return createElement = { html: '<div>'+innerHtml+'</div>' }
        }
          
      },
      events: <?php echo json_encode($push);?>,

       

    });

  
    calendar.render();


}

  jQuery(document).ready(function () {
     jQuery('.fc-dayGridWeek-button').trigger('click');
     jQuery('#calendar').css('opacity','1');

  });

</script>

<div id="create-task" class="modal">
    <form id="creat-task-form" method="POST">
        <header class="ndl-Header ndl-Header--section ndl-Modal-header">
            <h1 class="ndl-HeaderTitle ndl-HeaderTitle--section ndl-HeaderTitle--medium undefined"><div class="plan-CreateModal-title">Create New Task</div></h1>
        </header>
        <div class="form-group">
            <input name="task-title" autocomplete="off" required   class="input-field" maxlength="80" type="text" placeholder="Enter task title here" value="" />
            <p class="ndl-Text ndl-Text--secondary ndl-Input-charCount ndl-CharacterCount">0/80</p>
        </div>
        <div class="form-group">
            <label>
                Campaign *
                <select name="Campaign" class="form-field" id="campaign">
                    <?php 
            $terms = get_terms( 'campaign', array(
             'hide_empty' =>
                    false, ) ); if(!empty($terms)){ foreach($terms as $term){ echo '
                    <option value="'.$term->term_id.'">'.$term->name.'</option>
                    '; } }else{ echo '
                    <option val="">Create your campaign</option>
                    '; } ?>
                </select>
            </label>
        </div>
     
        <div class="form-group">
            <div class="ui-widget">
              <label>Workflow
              <select class="input-field" id="combobox" readonly>
                <option value>Select one...</option>
                 <?php 
                    if(!empty($workflows)){
                        foreach($workflows as $workflow){

                
                            echo '<option value="'. $workflow->ID.'">'. $workflow->post_title.'</option>';
                        }
                    }
                 ?>
              </select>
              
             <input  id="workflow_id" name="workflow_id" type="hidden" placeholder="" class="input-field" value="" />
              </label>
            </div>
            <div class="workflow_roles"></div>
             
        </div>
        <div class="form-group">
            <label>
                Task Due Date *
                <input required id="task-due-date" name="task_end_date" autocomplete="off" type="text" placeholder="" class="input-field ndl-DatePicker-input" value="" />
                <input id="task_start_date" name="task_start_date" type="hidden" placeholder="" class="input-field ndl-DatePicker-input" value="" />
            </label>
        </div>

        <div class="create-task-button">
            <div class="inner-buttons">
                <input type="hidden" name="type" value="TASK" />
                <a class="close ndl-Button ndl-Button--primary ndl-Button--medium" href="#" rel="modal:close">Close</a>
                <button class="ndl-Button ndl-Button--primary ndl-Button--medium submit-task">Create</button>
            </div>
        </div>
    </form>
</div>

<div id="create-event" class="modal">
    <form id="create-event-form" method="POST">
        <header class="ndl-Header ndl-Header--section ndl-Modal-header">
            <h1 class="ndl-HeaderTitle ndl-HeaderTitle--section ndl-HeaderTitle--medium undefined"><div class="plan-CreateModal-title">Create New Event</div></h1>
        </header>
        <div class="form-group">
            <input name="task-title" autocomplete="off" required  class="input-field" maxlength="80" type="text" placeholder="Add Event Name" value="" />
            <p class="ndl-Text ndl-Text--secondary ndl-Input-charCount ndl-CharacterCount">0/80</p>
        </div>
        <div class="form-group">
            <label>
                Event Description *
                <div name="event-secription" required class="ndl-TextArea ndl-TextArea--isResizeable ndl-FormControl-field">
                    <textarea class="ndl-TextArea-field" maxlength="250" placeholder="Add details about your event..."></textarea>
                    <p class="ndl-Text ndl-Text--secondary ndl-TextArea-charCount ndl-CharacterCount">0/250</p>
                </div>
            </label>
        </div>
        <div class="form-group">
            <label>
                Campaign *
                <select name="Campaign" class="form-field" id="campaign">
                    <?php 
            $terms = get_terms( 'campaign', array(
             'hide_empty' =>
                    false, ) ); if(!empty($terms)){ foreach($terms as $term){ echo '
                    <option value="'.$term->term_id.'">'.$term->name.'</option>
                    '; } }else{ echo '
                    <option val="">Create your campaign</option>
                    '; } ?>
                </select>

            </label>
        </div>
        <div class="form-group date-picker">
            <div class="form-field right">
                <label>
                    End Date *
                    <input id="event-due-date" autocomplete="off" required name="task_end_date" type="text" placeholder="" class="input-field ndl-DatePicker-input" value="" />
                    <input id="task_start_date-event" name="task_start_date" type="hidden" placeholder="" class="date input-field ndl-DatePicker-input" value="" />
                </label>
            </div>
        </div>

        <div class="create-task-button">
            <div class="inner-buttons">
                <input type="hidden" name="type" value="EVENT" />
                <a class="close ndl-Button ndl-Button--primary ndl-Button--medium" href="#" rel="modal:close">Close</a>
                <button class="ndl-Button ndl-Button--primary ndl-Button--medium submit-task">Create</button>
            </div>
        </div>
    </form>
</div>
</div>

